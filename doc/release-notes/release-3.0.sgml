<!doctype linuxdoc system>
<article>
<title>Squid 3.0 release notes</title>
<author>Squid Developers</author>
<date>$Id: release-3.0.sgml,v 1.15 2003/08/20 07:08:01 hno Exp $</date>

<abstract>
This document contains the release notes for version 3.0 of Squid.
Squid is a WWW Cache application developed by the National Laboratory
for Applied Network Research and members of the Web Caching community.
</abstract>

<toc>
<sect>Key changes from squid 2.5:
<p>
<itemize>
	<item>Convert core squid source to C++ (Robert Collins).
	<item>http_port optional, allowing for SSL-only operation. Squid will refuse to start unless at least one port is defined. (Henrik Nordstr&ouml;m).
	<item>Ability to read the configuration file from an external program pipe (Henrik Nordstr&ouml;m).
	<item>Major cleanup or CARP. Now plays well with the other peering algorithms as just another non-ICP peering method. This also allows CARP support to be compiled by default with no need to recompile Squid to use CARP (Henrik Nordstr&ouml;m)
	<item>Class 4 delay pools - user specific buckets. (Robert Collins).
	<item>Comms layer refactored to increase efficiency (Adrian Chadd).
	<item>epoll support (David Nicklay)
	<item>kqueue support (Adrian Chadd)
	<item>Range processing moved from client side to both client and server (Robert Collins).
	<item>Added support for sys/bitypes.h, apparently needed for some of the bittypes on tru64 and possibly others. (Henrik Nordstr&ouml;m)
	<item>Edge Side Include implementation (www.esi.org). (Robert Collins).
	<item>Reduce the depth of recursion in make, improving make -j performance. (Robert Collins)
	<item>Cleanup of the relation between accelerated request and transparently intercepted request. The two are now handled separately from each other. 
This fixes two issues:
	<itemize>
		<item>Transparently intercepted requests is no longer under the restrictions of accelerated requests in peering relations etc..
		<item>No risk of confusion in authentication. Authentication is now allowed for accelerated requests but not transparently intercepted requests.
	</itemize> (Henrik Nordstr&ouml;m)
	<item>Change --disable-hostname-checks to --enable-hostname-checks, default to not verify hostname sanity. (Henrik Nordstr&ouml;m)
	<item>also removed the dot magics from hostname parsing. These are more evil than helpful and breaks semantic transparency in certain configurations. (Henrik Nordstr&ouml;m)
	<item>added reporting of "Process Data Segment Size via sbrk()" when sbrk() call exists.  According to the sbrk() man page, calling sbrk(0) returns the end of the data segment.  By storing the data segment offset when Squid starts, we can report the size of the data segment at any time.  This might be a better metric than getrusage()'s MAX RSS, which, in my experience, is often less than the process size reported by 'ps' (presumably because some of the processes memory is swapped to disk).  However, initial tests show that the sbrk() trick reports a value slightly smaller than reported by 'ps'. (Duane Wessels)
	<item>failure_ratio is a ratio, not a percentage.  Removed %% from printf. (Duane Wessels)
	<item>Start using inline C and C++ code via .cci source files. This defaults to inlined, with a configure option to disable for troubleshooting or development. (Robert Collins).
	<item>Better MacOSX support (Robert Collins, Adrian Chadd, Henrik Nordstr&ouml;m)
	<item>--with-filedescriptors=XX configure option (Francesco Chemolli)
	<item>UNIX domain IPC now used by default for helpers, no loger relying on TCP/IP sockets via loopback. (Henrik Nordstr&ouml;m)
	<item>Removed potentially dangerous debugging related configure options. Developers know how to edit configure.in or set defines. (Henrik Nordstr&ouml;m)
	<item>--enable-large-files to enable support for large files (&gt;2GB) on 32-bit GNU libc systems. (Henrik Nordstr&ouml;m)
	<item>Digest auth helper improvements (Robert Collins, Sean Burford)
	<item>Digest authentication scheme bugfixs & improvements (Robert Collins)
	<item>accelerator mode cleaned up, using the design from the rproxy development branch
	<itemize>
		<item>The httpd_accel_* directives is now gone, replaced by http(s)_port options and cache_peer based request forwarding.
		<item>The http(s)_port options has a list of new options for controlling the type and mode of port created with respect to
		<itemize>
			<item>transparent proxying
			<item>plain acceleration
			<item>host header based acceleration
			<item>normal proxying (default)
		</itemize>
		<item>To enforce a reasonable level of security in accelerators, accelerated requests are denied to go direct unless forced by always_direct.
	</itemize>(Henrik Nordstr&ouml;m)
	<item>Cache manager auth helper output tidyup (Duane Wessels).
	<item>Native Windows port enhancements:
	<itemize>
		<item>Another fix for profiling support
		<item>Added correct timezone handling
		<item>Fixed rotate problem
		<item>Added native Windows support to client.cc
		<item>This patch add the native Windows support for profiling and fix some C++/C include files problems.
		<item>Support for Windows .NET (5.2). 
		<item>Added native Windows and Cygwin support to pinger.cc
		<item>Introduced the use of IPPROTO_TCP and IPPROTO_UDP defines instead of '0' on comm_open, needed by Winsocket. See this old squid-dev thread about http://www.squid-cache.org/mail-archive/squid-dev/200108/0162.html.
		<item>Added native Windows support to cachemgr.cc
		<item>Added native Windows support to dnsserver.cc
		<item>On Windows, fork() is not available, so we need to use a workaround in store_dir.cc for create store directories sequentially
	</itemize>By Guido Serassio.
	<item>SSL support update
	<itemize>
		<item>SSL encrypted peers
		<item>https:// gatewaying/proxying for clients not supporting SSL or URLs rewritten via a redirector to https://...
		<item>Client certificate support
		<item>Hardware crypto SSL acceleration support via OpenSSL engine
		<item>SSL key/certificate now read while parsing squid.conf to support secure key protection in combination with chroot..
		<item>A few minor bugfixes/optimizations
	</itemize>(Henrik Nordstr&ouml;m)
	<item>--enable-default-hostsfile configure option by Guido Serassio. Tells the default /etc/hosts file location
	<item>New squid.conf directive to disable hostname verifications. It isn't really our business to enforce what characters is used in hostnames. (Henrik Nordstr&ouml;m).
	<item>Peering enhancement options for satellite or other high latency links by Robert Cohen.
	<item>Cleanup of authentication forwarding, and added authentication gatewaying proxy-&gt;reverseproxy when the same Squid is acting as both proxy and reverseproxy with authentication. (Henrik Nordstr&ouml;m)
	<item>The mailto links on Squid's ERR pages now contain data about the cccurred error by default, so that the email will contain this data in its body. This feature can be disabled via the email_err_data directive. (Clemens L&ouml;ser)
	<item>pipeline_prefetch is disabled and known to be broken due to internal store_client_copy() change (Henrik Nordstr&ouml;m)
	<item>ncsa_auth extened with support for MD5 hashes. (Henrik Nordstr&ouml;m)
	<item>Complain if open of /dev/null fails; avoids infinite loop in ipcCreate() and gives a correct error message should this occur.
	<item>Properly quote the quoting character '%' in log_quote() and username_quote().
	<item>in icmpRecv(), Handle the case when recv() returns EAGAIN and do not treat it like an error.
	<item>Update squid to build with gcc/g++ 3.3 with no warnings.
	<item>wb_group updated to support domain qualified groups (Guido Serassio)
	<item>most helper interfaces now support multiple overlapping requests (external_acl_type, redirect_program, basic auth).
	<item>custom log formats, and the ability to log different requests to different log files.
	<item>ext_user acl type added for matching the user name returned by external acls. Not longer abusing the ident acl for this purpose
	<item>external_acl extended with soft timeouts
	<item>external_acl can optionally return information to be logged in access.log
	<item>Requests denied due to 'http_reply_access' are now logged with TCP_DENIED_REPLY.
	<item>Added counters for HTCP messages sent and received, reported in 'info' cache manager page.
	<item>Fixed 'ICP dynamic timeout algorithm ignores multicast' bug
	<item>Bug #743: "#ifdef HTTP_VIOLATIONS" should be "#if HTTP_VIOLATIONS"
</itemize>

<sect>Changes to squid.conf
<p><descrip>
	<tag>read_ahead_gap</tag>Config directive by Jeffrey D. Wheelhouse. Allows the read-ahead gap to be configured from squid.conf (previously hardcoded at 16 KB)
	<tag>request_entities</tag>New squid.conf directive "request_entities on/off".If set to "on" then Squid will allow GET/HEAD requests with request entities, even if such entites are "undefined" in the HTTP specification.  (Henrik Nordstr&ouml;m)
	<tag>cache_peer</tag>New options for reverse proxy setups
	<itemize>
		<item>originserver
		<item>name=XXX
		<item>forceddomain=XXX
	</itemize>
	<tag>https_port</tag>Many new SSL options
	<descrip>
		<tag>dhparams=/path/to/file.pem</tag> https_port option to specify DH parameters for forward-secrecy in encryption. (Henrik Nordstr&ouml;m)
		<tag>clientca= etc</tag>specifies which CA to accept client certificates from
		<tag>defaultsite</tag>specifies the accelerated site name
	</descrip>
	<tag>http(s)_port</tag>Many new options to control acceleration, transparent proxying etc
	<tag>header_replace</tag>This is now dependent on --disable-http-violations (Henrik Nordstr&ouml;m) 
	<tag>email_err_data</tag>Allow disabling the data now embedded in the mailto links on Squid's ERR pages.
	<tag>reply_body_max_size</tag>No longer uses allow/deny. Instead it is specified as a size followed by acl elements. The size "none" can be used for no limit (the default)
	<tag>external_acl_type</tag>The argument which was named concurrenty= in Squid-2.5 is now named children=. concurrency= has a different meaing in Squid-3.0 and your external acls will not work until updated.
	<tag>ext_user acl</tag>this acl matches the username returned by external acl. ident can no longer be used for this purpose.
	<tag>access_log</tag>The access_log directive now optionally includes specifications on what log format to use and acls matching which requests to log. Can be specified multiple times to log different requests to different files.
	<tag>logformat</tag>new directive to define custom log formats
	<tag>httpd_accel_*</tag>These directives have been replaced by http(s)_port options and cache_peer based request forwarding. Note that you can no longer run proxy and acceleration mode on the same port. If you previously did this you now need to define two ports, one for acceleration, one for proxying.
</descrip>

<sect>Known limitations
<p>
<itemize>
	<item>SSL Acceleration Support - CRL's are not currently supported. The design has been completed, but time to implement is missing - contact squid-dev@squid-cache.org for more details.
	<item>tcp_outgoing_addr/tos uses "fast" ACL checks and is somewhat limited in what kind of acl types you may use. Probably only src/my_port/my_addr/dstdomain/method/port/url* acl types is reliable.
	<item>reply_body_max_size is uses "fast" ACL checks and may occationally fail on acls which may require external lookups (dst/srcdomain/external).
</itemize>

<sect>Other internal changes mostly of interest to developers
<P><itemize>
	<item>Andres Kroonmaa's chunked memory pool allocator included.
	<item>clientStreams, rationalising the client side logic to allow plugin output streams, and providing a simple interface to the store. See the programmers guide for details. (Robert Collins).
	<item>Clean up the squid code to consistenly use &lsqb;u_]int&lt;len&gt;_t throughout, rather than some &lsqb;u_]num&lt;len&gt; and some &lsqb;u_]&lt;len&gt;_t instances. (Robert Collins).
	<item>Spelling corrections by Reuben Farrelly.
	<item>Object reference counting supported to ease some programming tasks (Robert Collins).
	<item>Deferred reads removed from comms layer, implemented a layer above, allowing more efficent comms layers (such as epoll). (Robert Collins).
	<item>ACL Source code extracted into multiple separate classes, allowing great flexability in future development, and also for custom squid builds today. (Robert Collins)
	<item>Delay classes heavily refactored to allow easier extension and reuse. (Robert Collins).
	<item>autoconf 2.5 support (Robert Collins).
	<item>Hi-resolution CPU profiling from Andres Kroonma, for single-threaded use only.
	<item>Cleaned up module/helper configure checks to use the same logics everywhere. (Henrik Nordstr&ouml;m)
	<item>Unify much of the IO logic, shrinking the code base for diskd/aufs/ufs. (Robert Collins).
	<item>Introduce 'make check' support to provide an automated test suite for squid. (Robert Collins).
	<item>pthreads detection and compilation bugfixes. (Henrik Nordstr&ouml;m, Robert Collins)
	<item>Killed the remains of ALARM_UPDATES_TIME (--enable-time-hack) (Henrik Nordstr&ouml;m)
	<ITEM>Centralised the IPC type selection to defines.h by the defines IPC_STREAM and IPC_DGRAM. (Henrik Nordstr&ouml;m)
	<item>Astyle is the code formatter of choice for squid-3 C++ code. See http://www.squid-cache.org/~robertc/squid-3-style.txt for the squid 3 style conventions.
	<item>Fix "access_log none" (and "forward_log none")  (Arkadi E. Shishlov).
</itemize>

</article>

