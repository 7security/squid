<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.50">
 <TITLE>Squid 3.1.PRE1 release notes</TITLE>
</HEAD>
<BODY>
<H1>Squid 3.1.PRE1 release notes</H1>

<H2>Squid Developers</H2>$Id: release-3.1.sgml,v 1.6 2008/01/17 10:09:05 hno Exp $
<HR>
<EM>This document contains the release notes for version 3.1 of Squid.
Squid is a WWW Cache application developed by the National Laboratory
for Applied Network Research and members of the Web Caching community.</EM>
<HR>
<H2><A NAME="s1">1. Notice</A></H2>

<P>The Squid Team are pleased to announce the release of Squid-3.1.PRE1 for pre-release testing.</P>
<P>This new release is available for download from 
<A HREF="http://www.squid-cache.org/Versions/v3/3.1/">http://www.squid-cache.org/Versions/v3/3.1/</A> or the 
<A HREF="http://www.squid-cache.org/Mirrors/http-mirrors.html">mirrors</A>.</P>
<P>A large number of the show-stopper bugs have been fixed along with general improvements to the ICAP support.
While this release is not deemed ready for production use, we believe it is ready for wider testing by the community.</P>
<P>We welcome feedback and bug reports. If you find a bug, please see 
<A HREF="http://wiki.squid-cache.org/SquidFaq/TroubleShooting#head-7067fc0034ce967e67911becaabb8c95a34d576d">http://wiki.squid-cache.org/SquidFaq/TroubleShooting#head-7067fc0034ce967e67911becaabb8c95a34d576d</A> for how to submit a report with a stack trace.</P>

<H2><A NAME="s2">2. Known issues</A></H2>

<P>Although this release is deemed good enough for testing in many setups, please note the existence of 
<A HREF="http://www.squid-cache.org/bugs/buglist.cgi?query_format=advanced&amp;short_desc_type=allwordssubstr&amp;short_desc=&amp;target_milestone=3.1&amp;long_desc_type=allwordssubstr&amp;long_desc=&amp;bug_file_loc_type=allwordssubstr&amp;bug_file_loc=&amp;status_whiteboard_type=allwordssubstr&amp;status_whiteboard=&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;emailtype1=substring&amp;email1=&amp;emailtype2=substring&amp;email2=&amp;bugidtype=include&amp;bug_id=&amp;votes=&amp;chfieldfrom=&amp;chfieldto=Now&amp;chfieldvalue=&amp;cmdtype=doit&amp;order=bugs.bug_severity&amp;field0-0-0=noop&amp;type0-0-0=noop&amp;value0-0-0=">open bugs against Squid-3.1</A>.</P>

<H2><A NAME="s3">3. Changes since earlier PRE releases of Squid-3.1</A></H2>

<P>The 3.1 change history can be 
<A HREF="http://www.squid-cache.org/Versions/v3/3.1/changesets/">viewed here</A>.</P>

<H2><A NAME="s4">4. Changes since Squid-3.0</A></H2>

<H2><A NAME="ss4.1">4.1 Major new features</A>
</H2>

<P>Squid 3.1 represents a new feature release above 3.0.</P>
<P>The most important of these new features are:</P>
<P>
<UL>
<LI>IPv6 Support</LI>
<LI>Error Page Localization</LI>
</UL>
</P>
<P>Most user-facing changes are reflected in squid.conf (see below).</P>

<H3>Internet Protocol version 6 (IPv6)</H3>

<P>Squid 3.1 supports IPv6. To enable IPv6 support, use the ./configure --enable-ipv6 option</P>

<H3>New Features for IPv6</H3>

<P>Squid handles localhost values seperately. For the purpose of ACLs and also external
connections ::1 is considered a seperate IP from 127.0.0.1. This means all ACL which
define behaviour for localhost may need ::1/128 included.</P>

<P>--with-localhost-ipv6 option is provided for Pure-IPv6 setups who do not want to be
bothered by the localhost vagaries. It will enable logics to map all localhost traffic
through ::1 unless an IPv4-only link is required.</P>

<P>Additional ./configure --with-ipv4-mapped option is provided for OS that require a socket setting
to accept IPv4 addresses on IPv6 sockets, squid performs v4-mapping on these addresses
It is intended primarily to be used for Windows Vista builds.</P>

<P>Pinger has been upgraded to perform both ICMP and ICMPv6 as required.
As a result of this and due to a change in the binary protocol format between them,
new builds of squid are no longer backwards-compatible with old pinger binaries.
You will need to perform "make install-pinger" again after installing squid.</P>

<P>Peer and Client SNMP tables have been altered to handle IPv6 addresses.
As a side effect of this the long-missing fix to show seperate named peers on one IP
has been integrated. Making the SNMP peer table now produce correct output.
The table structure change is identical for both IPv4-only and Dual modes but with
IPv4-only simply not including any IP6 entries. This means any third-party SNMP
software which hard coded the MIB paths needs to be upgraded for this Squid release.</P>


<H3>Limitations of IPv6 Support</H3>

<P>Specify a specific tcp_outgoing_address and the clients who match its ACL are limited
to the IPv4 or IPv6 network that address belongs to. They are not permitted over the
IPv4-IPv6 boundary. Some ACL voodoo can however be applied to explicitly route the
IPv6/IPv4 bound traffic out an appropriate interface.
<PRE>
    acl toIP6 dst ipv6
    tcp_outgoing_address 2001::1 toIP6
    tcp_outgoing_address 10.0.0.1 !toIP6
</PRE>
</P>

<P>WCCP is not available (neither version 1 or 2). It remains built into squid for use with IPv4 traffic but IPv6 cannot use it.</P>

<P>Transparent/Interception is done via NAT at the OS level and is not available in IPv6.
Squid will ensure that any port set with transparent or tproxy options be an IPv4-only
listening address. Wildcard can still be used but will not open as an IPv6.
To ensure that squid can accept IPv6 traffic on its default port, an alternative should
be chosen to handle transparent traffic.
<PRE>
   http_port 3128
   http_port 8080 transparent
</PRE>
</P>

<P>The bundled NTLM Auth helper is IPv4-native between itself and the NTLM server.
A new one will be needed for IPv6 traffic between the helper and server.</P>

<P>The bundled RADIUS Auth helper is IPv4-native, both in traffic between and data storage
with the RADIUS server. A new helper will be needed for IPv6 RADIUS protocol.</P>


<H3>Error Page Localization</H3>

<P>The error pages presented by squid may now be localized per-request to match the visitors local preferred language.</P>

<P>Squid needs to be build with the --enable-auto-locale option. And the error_directory option in squid.conf needs to be removed.</P>

<P>For best coverage of languages, using the latest language pack of error files is recommended.
Updates can be downloaded from 
<A HREF="http://www.squid-cahch.org/Versions/langpack/">www.squid-cache.org/Versions/langpack/</A></P>

<P>The squid developers are interested in making squid available in a wide variety of languages.
Contributions of new languages is encouraged.
Details at 
<A HREF="http://wiki.squid-cache.org/Translations">http://wiki.squid-cache.org/Translations</A></P>

<H2><A NAME="s5">5. Windows support</A></H2>

<P>This Squid version can run on Windows as a system service using the Cygwin emulation environment, 
or can be compiled in Windows native mode using the MinGW + MSYS development environment. Windows NT 4 SP4 and later are supported.</P>
<P>On Windows 2000 and later the service is configured to use the Windows Service Recovery option
restarting automatically after 60 seconds.</P>

<H2><A NAME="ss5.1">5.1 Usage</A>
</H2>

<P>Some new command line options was added for the Windows service support:</P>
<P>The service installation is made with -i command line switch, it's possible to use -f switch at
the same time for specify a different config-file settings for the Squid Service that will be
stored on the Windows Registry.</P>
<P>A new -n switch specify the Windows Service Name, so multiple Squid instance are allowed.
<EM>"Squid"</EM> is the default when the switch is not used.</P>
<P>So, to install the service, the syntax is: </P>

<P>
<PRE>
squid -i [-f file] [-n name]
</PRE>
</P>
<P>Service uninstallation is made with -r command line switch with the appropriate -n switch.</P>
<P>The -k switch family must be used with the appropriate -f and -n switches, so the syntax is: </P>
<P>
<PRE>
squid -k command [-f file] -n service-name
</PRE>

where <EM>service-name</EM> is the name specified with -n options at service install time.</P>
<P>To use the Squid original command line, the new -O switch must be used ONCE, the syntax is: </P>
<P>
<PRE>
squid -O cmdline [-n service-name]
</PRE>

If multiple service command line options must be specified, use quote. The -n switch is
needed only when a non default service name is in use.</P>
<P>Don't use the "Start parameters" in the Windows 2000/XP/2003 Service applet: they are
specific to Windows services functionality and Squid is not designed for understand they.</P>
<P>In the following example the command line of the "squidsvc" Squid service is set to "-D -u 3130": </P>
<P>
<PRE>
squid -O "-D -u 3130" -n squidsvc
</PRE>
</P>

<H2><A NAME="ss5.2">5.2 PSAPI.DLL (Process Status Helper) Considerations</A>
</H2>

<P>The process status helper functions make it easier for you to obtain information about
processes and device drivers running on Microsoft® Windows NT®/Windows® 2000. These
functions are available in PSAPI.DLL, which is distributed in the Microsoft® Platform
Software Development Kit (SDK). The same information is generally available through the
performance data in the registry, but it is more difficult to get to it. PSAPI.DLL is
freely redistributable.</P>
<P>PSAPI.DLL is available only on Windows NT, 2000, XP and 2003. The implementation in Squid is
aware of this, and try to use it only on the right platform.</P>
<P>On Windows NT PSAPI.DLL can be found as component of many applications, if you need it,
you can find it on Windows NT Resource KIT. If you have problem, it can be
downloaded from here:
<A HREF="http://download.microsoft.com/download/platformsdk/Redist/4.0.1371.1/NT4/EN-US/psinst.EXE">http://download.microsoft.com/download/platformsdk/Redist/4.0.1371.1/NT4/EN-US/psinst.EXE</A></P>
<P>On Windows 2000 and later it is available installing the Windows Support Tools, located on the
Support\Tools folder of the installation Windows CD-ROM.</P>

<H2><A NAME="ss5.3">5.3 Registry DNS lookup</A>
</H2>

<P>On Windows platforms, if no value is specified in the <EM>dns_nameservers</EM> option on
squid.conf or in the /etc/resolv.conf file, the list of DNS name servers are
taken from the Windows registry, both static and dynamic DHCP configurations
are supported.</P>

<H2><A NAME="ss5.4">5.4 Compatibility Notes</A>
</H2>

<P>
<UL>
<LI>It's recommended to use '/' char in Squid paths instead of '\'</LI>
<LI>Paths with spaces (like 'C:\Programs Files\Squid) are NOT supported by Squid</LI>
<LI>Include wildcard patterns in squid.conf are NOT supported on Windows</LI>
<LI>When using ACL like 'acl aclname acltype "file"' the file must be in DOS text
format (CR+LF) and the full Windows path must be specified, for example:

<PRE>
acl blocklist url_regex -i "c:/squid/etc/blocked1.txt"
</PRE>

</LI>
<LI>The Windows equivalent of '/dev/null' is 'NUL'</LI>
<LI>Squid doesn't know how to run external helpers based on scripts, like .bat, .cmd,
.vbs, .pl, etc. So in squid.conf the interpreter path must be always specified, for example:

<PRE>
redirect_program c:/perl/bin/perl.exe c:/squid/libexec/redir.pl
redirect_program c:/winnt/system32/cmd.exe /C c:/squid/libexec/redir.cmd
</PRE>
</LI>
<LI>When Squid runs in command line mode, the launching user account must have administrative privilege on the system</LI>
<LI>"Start parameters" in the Windows 2000/XP/2003 Service applet cannot be used</LI>
<LI>Building with MinGW, when the configure option --enable-truncate is used, Squid cannot run on Windows NT, only Windows 2000 and later are supported</LI>
</UL>
</P>

<H2><A NAME="ss5.5">5.5 Known Limitations</A>
</H2>

<P>
<UL>
<LI>DISKD: still needs to be ported</LI>
<LI>WCCP: cannot work because user space GRE support on Windows is missing</LI>
<LI>Transparent Proxy: missing Windows non commercial interception driver</LI>
<LI>Some code sections can make blocking calls.</LI>
<LI>Some external helpers may not work.</LI>
<LI>File Descriptors number hard-limited to 2048 when building with MinGW.</LI>
</UL>
</P>

<H2><A NAME="ss5.6">5.6 Using cache manager on Windows</A>
</H2>

<P>On Windows, cache manager (cachemgr.cgi) can be used with Microsoft IIS or Apache.
Some specific configuration could be needed:</P>

<H3>IIS 6 (Windows 2003)</H3>

<P>On IIS 6.0 all CGI extensions are denied by default for security reason, so the following configuration is needed:</P>
<P>
<UL>
<LI>Create a cgi-bin Directory</LI>
<LI>Define the cgi-bin IIS Virtual Directory with read and CGI execute IIS
permissions, ASP scripts are not needed. This automatically defines a
cgi-bin IIS web application </LI>
<LI>Copy cachemgr.cgi into cgi-bin directory and look to file permissions:
the IIS system account and SYSTEM must be able to read and execute the file</LI>
<LI>In IIS manager go to Web Service extensions and add a new Web Service
Extension called <EM>"Squid Cachemgr"</EM>, add the cachemgr.cgi file and set the
extension status to <EM>Allowed</EM></LI>
</UL>
</P>

<H3>Apache:</H3>

<P>On Windows, cachemgr.cgi needs to create a temporary file, so Apache must be instructed
to pass the TMP and TEMP Windows environment variables to CGI applications:
<PRE>
ScriptAlias /squid/cgi-bin/ "c:/squid/libexec/"
&lt;Location /squid/cgi-bin/cachemgr.cgi&gt;
    PassEnv TMP TEMP
    Order allow,deny
    Allow from workstation.example.com
&lt;/Location&gt;
</PRE>
</P>



<H2><A NAME="ss5.7">5.7 Changes to squid.conf</A>
</H2>

<P>There have been changes to Squid's configuration file since Squid-3.0.</P>
<P>This section gives a thorough account of those changes in three categories:</P>
<P>
<UL>
<LI>
<A HREF="#newtags">New tags</A></LI>
<LI>
<A HREF="#modifiedtags">Changes to existing tags</A></LI>
<LI>
<A HREF="#removedtags">Removed tags</A></LI>
</UL>
</P>




<H3><A NAME="newtags"></A> New tags</H3>

<P>
<DL>
<DT><B>pinger_enable</B><DD>
<P>New option to enable/disable the ICMP pinger helper with a reconfigure instead of a full rebuild.
<PRE>
        Control whether the pinger is active at run-time.
        Enables turning ICMP pinger on and off with a simple squid -k reconfigure.
        default is on when --enable-icmp is compiled in.
        
</PRE>
</P>

<DT><B>dns_v4_fallback</B><DD>
<P>New option to prevent squid from always looking up IPv4 regardless of whether IPv6 addresses are found.
Squid will follow a policy of prefering IPv6 links, keeping the IPv4 only as a safety net behind IPv6.
<PRE>
        Standard practice with DNS is to lookup either A or AAAA records
        and use the results if it succeeds. Only looking up the other if
        the first attempt fails or otherwise produces no results.

        That policy however will cause squid to produce error pages for some
        servers that advertise AAAA but are unreachable over IPv6.

        If this is ON  squid will always lookup both AAAA and A, using both.
        If this is OFF squid will lookup AAAA and only try A if none found.

        WARNING: There are some possibly unwanted side-effects with this on:
                *) Doubles the load placed by squid on the DNS network.
                *) May negatively impact connection delay times.
        
</PRE>
</P>

<DT><B>include</B><DD>
<P>New option to import entire secondary configuration files into squid.conf.
<PRE>
        Squid will follow the files immediately and insert all their content
        as if it was at that position in squid.conf. As per squid.conf some
        options are order-specific within the config as a whole.

        A few layers of include are allowed, but too many are confusing and
        squid will enforce an include depth of 16 files.

        Syntax:
                include /path/to/file1 /path/to/file2
        
</PRE>
</P>

<DT><B>error_default_language</B><DD>
<P>New option to replace the old configure option --enable-default-err-language
<PRE>
        Set the default language which squid will send error pages in
        if no existing translation matches the clients language
        preferences.

        If unset (default) generic English will be used.
        
</PRE>
</P>


</DL>
</P>

<H3><A NAME="modifiedtags"></A> Changes to existing tags</H3>

<P>
<DL>
<DT><B>acl dst ipvs</B><DD>
<P>New preset content - ipv6 - available as a preset type in the src and dst ACL matching all of the public IPv6 network space.
<PRE>
        acl aclname dst ipv6
        
</PRE>
</P>

<DT><B>http(s)_port name= intercept</B><DD>
<P>New port options.
<PRE>
           name=        Specifies a internal name for the port. Defaults to
                        the port specification (port or addr:port)

           intercept    Rename of old 'transparent' option to indicate proper functionality.
        
</PRE>
</P>

<DT><B>acl myportname</B><DD>
<P>New acl type myportname, matching the name of the http(s)_port where the request was accepted
<PRE>
        acl aclname myportname 3128 ...         # http(s)_port name
        
</PRE>
</P>

<DT><B>external_acl_type</B><DD>
<P>New options 'ipv4' and 'ipv6' are added to set the IPv4/v6 protocol between squid and its helpers.
Please be aware of some limits to these options. These options only affet the transport protocol used
to send data to and from the helpers. Squid in IPv6-mode may still send %SRC addresses in IPv4 or IPv6
format, so all helpers will need to be checked and converted to cope with such information cleanly.
<PRE>
          ipv4 / ipv6   IP-mode used to communicate to this helper.
                        For compatability with older configurations and helpers
                        'ipv4' is the default unless --with-localhost-ipv6 is used.
                        --with-localhost-ipv6 changes the default to 'ipv6'.
                        SPECIAL NOTE: explicit use of these options override --with-localhost-ipv6
        
</PRE>
</P>

<DT><B>tcp_outgoing_address</B><DD>
<P>This option causes some problems when bridging IPv4 and IPv6. A workaround has been provided.
<PRE>
        Squid is built with a capability of bridging the IPv4 and IPv6 internets.
        tcp_outgoing_address as previously used breaks this bridging by forcing
        all outbound traffic through a certain IPv4 which may be on the wrong
        side of the IPv4/IPv6 boundary.

        To operate with tcp_outgoing_address and keep the bridging benefits
        an additional ACL needs to be used which ensures the IPv6-bound traffic
        is never forced or permitted out the IPv4 interface.

        acl to_ipv6 dst ipv6
        tcp_outgoing_address 2002::c001 good_service_net to_ipv6
        tcp_outgoing_address 10.0.0.2 good_service_net !to_ipv6

        tcp_outgoing_address 2002::beef normal_service_net to_ipv6
        tcp_outgoing_address 10.0.0.1 normal_service_net !to_ipv6

        tcp_outgoing_address 2002::1 to_ipv6
        tcp_outgoing_address 10.0.0.3 !to_ipv6
        
</PRE>
</P>

<DT><B>balance_on_multiple_ip</B><DD>
<P>The previous default behavour (rotate per-request) of this setting causes failover clashes with IPv6 built-in mechanisms.
It has thus been turned off by default. Making the 'best choice' IP continue in use for any hostname until it encounters a connection failure and failover drops to the next known IP.
<PRE>
       Modern IP resolvers in squid sort lookup results by preferred access.
       By default squid will use these IP in order and only rotates to
       the next listed when the most preffered fails.

       Some load balancing servers based on round robin DNS have been
       found not to preserve user session state across requests
       to different IP addresses.

       Enabling this directive Squid rotates IP's per request.
        
</PRE>
</P>

<DT><B>http_port</B><DD>
<P>option 'transparent' is being deprecated in favour of 'intercept' which more clearly identifies what the option does.
For now option 'tproxy' remains with old behaviour meaning fully-invisible proxy using TPROXY support.</P>

<DT><B>error_directory</B><DD>
<P>Now an optiona entry in squid.conf. If present it will force all visitors to receive the error pages
contained in the directory it points at. If absent error page localization will be given a chance.
<PRE>
        If you wish to create your own versions of the default
        error files to customize them to suit your company copy
        the error/template files to another directory and point
        this tag at them.

        WARNING: This option will disable multi-language support
                 on error pages if used.

        The squid developers are interested in making squid available in
        a wide variety of languages. If you are making translations for a
        language that Squid does not currently provide please consider
        contributing your translation back to the project.
        http://wiki.squid-cache.org/Translations

        The squid developers working on translations are happy to supply drop-in
        translated error files in exchange for any new language contributions.
        
</PRE>
</P>

</DL>
</P>


<H3><A NAME="removedtags"></A> Removed tags</H3>

<P>
<DL>

<DT><B>dns_testnames</B><DD>
<P>Obsolete. This feature is no longer relevant to modern networks and causes boot problems.</P>

</DL>
</P>


<H2><A NAME="ss5.8">5.8 Changes to ./configure Options</A>
</H2>

<P>There have been some changes to Squid's build configuration since Squid-3.0.</P>
<P>This section gives an account of those changes in three categories:</P>
<P>
<UL>
<LI>
<A HREF="#newoptions">New options</A></LI>
<LI>
<A HREF="#modifiedoptions">Changes to existing options</A></LI>
<LI>
<A HREF="#notportedoptions">Not yet available options</A></LI>
<LI>
<A HREF="#removedoptions">Removed options</A></LI>
</UL>
</P>



<H3><A NAME="newoptions"></A> New options</H3>

<P>
<DL>
<DT><B>--enable-ipv6</B><DD>
<P>Buildwith IPv6 support. The default is to build without.</P>

<DT><B>--with-localhost-ipv6</B><DD>
<P>Build support for squid to map all 127.0.0.1 traffic onto ::1.
The default is to build with 127.0.0.1 and ::1 being considered seperate IP.
see the IPv6 details above for a better description. </P>

<DT><B>--with-ipv6-split-stack</B><DD>
<P>Enable special additions for IPv6 support in Windows XP.
see the IPv6 details above for a better description.</P>

<DT><B>--with-ipv4-mapped</B><DD>
<P>Enable special additions for IPv6 support in Windows Vista.
see the IPv6 details above for a better description.</P>

<DT><B>--with-dns-cname</B><DD>
<P>Enable CNAME recursion within the Internal DNS resolver stub squid uses.
This has no effect on the external DNS helper.
Please note this extension is still experimental and may encounter problems.
To see if it is actually needed you can run squid without it for a period and
check the CNAME-Only Requests statistics squid maintains.
If it produces ongoing serious problems the external helper may be needed
but please report the bugs anyway.</P>

<DT><B>--enable-auto-locale</B><DD>
<P>Enable error page localization for visitors.</P>

</DL>
</P>
<H3><A NAME="modifiedoptions"></A> Changes to existing options</H3>

<P>
<DL>
<DT><B>--disable-internl-dns</B><DD>
<P>Better support for Linux using the external DNS helper.
The helper will compile and work with dns_nameservers on more variants of Linux than previously.</P>

<DT><B>--enable-linux-netfilter</B><DD>
<P>This option now enables support for all three netfilter interception targets.
Adding TPROXY version 4+ support to squid through the TPROXY target.
This options requires a linux kernel 2.6.25 or later for embeded netfilter TPROXY targets.
Older REDIRECT and DNAT targets work as before on HTTP ports marked 'intercept'.</P>

</DL>
</P>
<H3><A NAME="notportedoptions"></A> Not yet available options</H3>

<P>These configure options have not yet been ported to Squid-3. If you need something to do then
porting one of these from Squid-2 to Squid-3 is most welcome.</P>
<P>
<DL>
<DT><B>--enable-devpoll</B><DD>
<P>Support for Solaris /dev/poll</P>

<DT><B>--enable-select-simple</B><DD>
<P>Basic POSIX select() loop without any binary fd_set optimizations.</P>

<DT><B>--enable-follow-x-forwarded-for</B><DD>
<P>Support following the X-Forwarded-For HTTP header for determining the
client IP address</P>
</DL>
</P>

<H3><A NAME="removedoptions"></A> Removed options</H3>

<P>The following configure options have been removed.</P>
<P>
<DL>
<DT><B>--enable-linux-tproxy</B><DD>
<P>Replaced by --enable-linux-tproxy2 to make way for differences in TPROXY v2 and v4 support.</P>
<DT><B>--enable-default-err-language</B><DD>
<P>Replaced by error_default_language squid.conf option</P>
<DT><B>--enable-err-languages</B><DD>
<P>Removed.</P>
</DL>
</P>

</BODY>
</HTML>
