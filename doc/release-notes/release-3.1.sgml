<!doctype linuxdoc system>
<article>
<title>Squid 3.1.PRE1 release notes</title>
<author>Squid Developers</author>
<date>$Id: release-3.1.sgml,v 1.6 2008/01/17 10:09:05 hno Exp $</date>

<abstract>
This document contains the release notes for version 3.1 of Squid.
Squid is a WWW Cache application developed by the National Laboratory
for Applied Network Research and members of the Web Caching community.
</abstract>

<toc>

<sect>Notice
<p>
The Squid Team are pleased to announce the release of Squid-3.1.PRE1 for pre-release testing.

This new release is available for download from <url url="http://www.squid-cache.org/Versions/v3/3.1/"> or the <url url="http://www.squid-cache.org/Mirrors/http-mirrors.html" name="mirrors">.

A large number of the show-stopper bugs have been fixed along with general improvements to the ICAP support.
While this release is not deemed ready for production use, we believe it is ready for wider testing by the community.

We welcome feedback and bug reports. If you find a bug, please see <url url="http://wiki.squid-cache.org/SquidFaq/TroubleShooting#head-7067fc0034ce967e67911becaabb8c95a34d576d"> for how to submit a report with a stack trace.

<sect>Known issues
<p>
Although this release is deemed good enough for testing in many setups, please note the existence of <url url="http://www.squid-cache.org/bugs/buglist.cgi?query_format=advanced&amp;short_desc_type=allwordssubstr&amp;short_desc=&amp;target_milestone=3.1&amp;long_desc_type=allwordssubstr&amp;long_desc=&amp;bug_file_loc_type=allwordssubstr&amp;bug_file_loc=&amp;status_whiteboard_type=allwordssubstr&amp;status_whiteboard=&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;emailtype1=substring&amp;email1=&amp;emailtype2=substring&amp;email2=&amp;bugidtype=include&amp;bug_id=&amp;votes=&amp;chfieldfrom=&amp;chfieldto=Now&amp;chfieldvalue=&amp;cmdtype=doit&amp;order=bugs.bug_severity&amp;field0-0-0=noop&amp;type0-0-0=noop&amp;value0-0-0=" name="open bugs against Squid-3.1">.

<sect>Changes since earlier PRE releases of Squid-3.1
<p>
The 3.1 change history can be <url url="http://www.squid-cache.org/Versions/v3/3.1/changesets/" name="viewed here">.

<sect>Changes since Squid-3.0

<sect1>Major new features
<p>
Squid 3.1 represents a new feature release above 3.0.

The most important of these new features are:

<itemize>
	<item>IPv6 Support
	<item>Error Page Localization
</itemize>

Most user-facing changes are reflected in squid.conf (see below).

<sect2>Internet Protocol version 6 (IPv6)

<p>Squid 3.1 supports IPv6. To enable IPv6 support, use the ./configure --enable-ipv6 option

<sect3>New Features for IPv6

<p>Squid handles localhost values seperately. For the purpose of ACLs and also external
 connections ::1 is considered a seperate IP from 127.0.0.1. This means all ACL which
 define behaviour for localhost may need ::1/128 included.

<p>--with-localhost-ipv6 option is provided for Pure-IPv6 setups who do not want to be
 bothered by the localhost vagaries. It will enable logics to map all localhost traffic
 through ::1 unless an IPv4-only link is required.

<p>Additional ./configure --with-ipv4-mapped option is provided for OS that require a socket setting
 to accept IPv4 addresses on IPv6 sockets, squid performs v4-mapping on these addresses
 It is intended primarily to be used for Windows Vista builds.

<p>Pinger has been upgraded to perform both ICMP and ICMPv6 as required.
 As a result of this and due to a change in the binary protocol format between them,
 new builds of squid are no longer backwards-compatible with old pinger binaries.
 You will need to perform "make install-pinger" again after installing squid.

<p>Peer and Client SNMP tables have been altered to handle IPv6 addresses.
 As a side effect of this the long-missing fix to show seperate named peers on one IP
 has been integrated. Making the SNMP peer table now produce correct output.
 The table structure change is identical for both IPv4-only and Dual modes but with
 IPv4-only simply not including any IP6 entries. This means any third-party SNMP
 software which hard coded the MIB paths needs to be upgraded for this Squid release.


<sect3>Limitations of IPv6 Support

<p>Specify a specific tcp_outgoing_address and the clients who match its ACL are limited
 to the IPv4 or IPv6 network that address belongs to. They are not permitted over the
 IPv4-IPv6 boundary. Some ACL voodoo can however be applied to explicitly route the
 IPv6/IPv4 bound traffic out an appropriate interface.
<verb>
    acl toIP6 dst ipv6
    tcp_outgoing_address 2001::1 toIP6
    tcp_outgoing_address 10.0.0.1 !toIP6
</verb>

<p>WCCP is not available (neither version 1 or 2). It remains built into squid for use with IPv4 traffic but IPv6 cannot use it.

<p>Transparent/Interception is done via NAT at the OS level and is not available in IPv6.
   Squid will ensure that any port set with transparent or tproxy options be an IPv4-only
   listening address. Wildcard can still be used but will not open as an IPv6.
   To ensure that squid can accept IPv6 traffic on its default port, an alternative should
   be chosen to handle transparent traffic.
<verb>
   http_port 3128
   http_port 8080 transparent
</verb>

<p>The bundled NTLM Auth helper is IPv4-native between itself and the NTLM server.
   A new one will be needed for IPv6 traffic between the helper and server.

<p>The bundled RADIUS Auth helper is IPv4-native, both in traffic between and data storage
   with the RADIUS server. A new helper will be needed for IPv6 RADIUS protocol.


<sect2>Error Page Localization
<p>
The error pages presented by squid may now be localized per-request to match the visitors local preferred language.

<p>Squid needs to be build with the --enable-auto-locale option. And the error_directory option in squid.conf needs to be removed.

<p>For best coverage of languages, using the latest language pack of error files is recommended.
Updates can be downloaded from <url url="http://www.squid-cahch.org/Versions/langpack/" name="www.squid-cache.org/Versions/langpack/">

<p>The squid developers are interested in making squid available in a wide variety of languages.
   Contributions of new languages is encouraged.
   Details at <url url="http://wiki.squid-cache.org/Translations" named="The Squid wiki">


<sect1>Changes to squid.conf
<p>
There have been changes to Squid's configuration file since Squid-3.0.

This section gives a thorough account of those changes in three categories:

<itemize>
	<item><ref id="newtags" name="New tags">
	<item><ref id="modifiedtags" name="Changes to existing tags">
	<item><ref id="removedtags" name="Removed tags">
</itemize>

<p>


<sect2>New tags<label id="newtags">
<p>
<descrip>
        <tag>pinger_enable</tag>
        <p>New option to enable/disable the ICMP pinger helper with a reconfigure instead of a full rebuild.
        <verb>
        Control whether the pinger is active at run-time.
        Enables turning ICMP pinger on and off with a simple squid -k reconfigure.
        default is on when --enable-icmp is compiled in.
        </verb>

        <tag>dns_v4_fallback</tag>
        <p>New option to prevent squid from always looking up IPv4 regardless of whether IPv6 addresses are found.
           Squid will follow a policy of prefering IPv6 links, keeping the IPv4 only as a safety net behind IPv6.
        <verb>
        Standard practice with DNS is to lookup either A or AAAA records
        and use the results if it succeeds. Only looking up the other if
        the first attempt fails or otherwise produces no results.

        That policy however will cause squid to produce error pages for some
        servers that advertise AAAA but are unreachable over IPv6.

        If this is ON  squid will always lookup both AAAA and A, using both.
        If this is OFF squid will lookup AAAA and only try A if none found.

        WARNING: There are some possibly unwanted side-effects with this on:
                *) Doubles the load placed by squid on the DNS network.
                *) May negatively impact connection delay times.
        </verb>

	<tag>include</tag>
	<p>New option to import entire secondary configuration files into squid.conf.
	<verb>
	Squid will follow the files immediately and insert all their content
	as if it was at that position in squid.conf. As per squid.conf some
	options are order-specific within the config as a whole.

	A few layers of include are allowed, but too many are confusing and
	squid will enforce an include depth of 16 files.

	Syntax:
		include /path/to/file1 /path/to/file2
	</verb>

        <tag>error_default_language</tag>
        <p>New option to replace the old configure option --enable-default-err-language
        <verb>
        Set the default language which squid will send error pages in
        if no existing translation matches the clients language
        preferences.

        If unset (default) generic English will be used.
	</verb>


</descrip>

<sect2>Changes to existing tags<label id="modifiedtags">
<p>
<descrip>
	<tag>acl dst ipvs</tag>
	<p>New preset content - ipv6 - available as a preset type in the src and dst ACL matching all of the public IPv6 network space.
        <verb>
	acl aclname dst ipv6
        </verb>

	<tag>http(s)_port name= intercept</tag>
	<p>New port options.
        <verb>
           name=        Specifies a internal name for the port. Defaults to
                        the port specification (port or addr:port)

           intercept    Rename of old 'transparent' option to indicate proper functionality.
        </verb>

	<tag>acl myportname</tag>
	<p>New acl type myportname, matching the name of the http(s)_port where the request was accepted
        <verb>
        acl aclname myportname 3128 ...         # http(s)_port name
        </verb>

        <tag>external_acl_type</tag>
        <p>New options 'ipv4' and 'ipv6' are added to set the IPv4/v6 protocol between squid and its helpers.
           Please be aware of some limits to these options. These options only affet the transport protocol used
	   to send data to and from the helpers. Squid in IPv6-mode may still send %SRC addresses in IPv4 or IPv6
	   format, so all helpers will need to be checked and converted to cope with such information cleanly.
        <verb>
          ipv4 / ipv6   IP-mode used to communicate to this helper.
                        For compatability with older configurations and helpers
                        'ipv4' is the default unless --with-localhost-ipv6 is used.
                        --with-localhost-ipv6 changes the default to 'ipv6'.
                        SPECIAL NOTE: explicit use of these options override --with-localhost-ipv6
        </verb>

        <tag>tcp_outgoing_address</tag>
        <p>This option causes some problems when bridging IPv4 and IPv6. A workaround has been provided.
        <verb>
        Squid is built with a capability of bridging the IPv4 and IPv6 internets.
        tcp_outgoing_address as previously used breaks this bridging by forcing
        all outbound traffic through a certain IPv4 which may be on the wrong
        side of the IPv4/IPv6 boundary.

        To operate with tcp_outgoing_address and keep the bridging benefits
        an additional ACL needs to be used which ensures the IPv6-bound traffic
        is never forced or permitted out the IPv4 interface.

        acl to_ipv6 dst ipv6
        tcp_outgoing_address 2002::c001 good_service_net to_ipv6
        tcp_outgoing_address 10.0.0.2 good_service_net !to_ipv6

        tcp_outgoing_address 2002::beef normal_service_net to_ipv6
        tcp_outgoing_address 10.0.0.1 normal_service_net !to_ipv6

        tcp_outgoing_address 2002::1 to_ipv6
        tcp_outgoing_address 10.0.0.3 !to_ipv6
        </verb>

        <tag>balance_on_multiple_ip</tag>
        <p>The previous default behavour (rotate per-request) of this setting causes failover clashes with IPv6 built-in mechanisms.
           It has thus been turned off by default. Making the 'best choice' IP continue in use for any hostname until it encounters a connection failure and failover drops to the next known IP.
        <verb>
       Modern IP resolvers in squid sort lookup results by preferred access.
       By default squid will use these IP in order and only rotates to
       the next listed when the most preffered fails.

       Some load balancing servers based on round robin DNS have been
       found not to preserve user session state across requests
       to different IP addresses.

       Enabling this directive Squid rotates IP's per request.
        </verb>

	<tag>http_port</tag>
	<p>option 'transparent' is being deprecated in favour of 'intercept' which more clearly identifies what the option does.
	For now option 'tproxy' remains with old behaviour meaning fully-invisible proxy using TPROXY support.</p>

	<tag>error_directory</tag>
	<p>Now an optiona entry in squid.conf. If present it will force all visitors to receive the error pages
	contained in the directory it points at. If absent error page localization will be given a chance.
	<verb>
        If you wish to create your own versions of the default
        error files to customize them to suit your company copy
        the error/template files to another directory and point
        this tag at them.

        WARNING: This option will disable multi-language support
                 on error pages if used.

        The squid developers are interested in making squid available in
        a wide variety of languages. If you are making translations for a
        language that Squid does not currently provide please consider
        contributing your translation back to the project.
        http://wiki.squid-cache.org/Translations

        The squid developers working on translations are happy to supply drop-in
        translated error files in exchange for any new language contributions.
	</verb>

</descrip>


<sect2>Removed tags<label id="removedtags">
<p>
<descrip>

</descrip>


<sect1>Changes to ./configure Options
<p>
There have been some changes to Squid's build configuration since Squid-3.0.

This section gives an account of those changes in three categories:

<itemize>
	<item><ref id="newoptions" name="New options">
	<item><ref id="modifiedoptions" name="Changes to existing options">
	<item><ref id="notportedoptions" name="Not yet available options">
	<item><ref id="removedoptions" name="Removed options">
</itemize>
<p>


<sect2>New options<label id="newoptions">

<p>
<descrip>
	<tag>--enable-ipv6</tag>
	<p>Buildwith IPv6 support. The default is to build without.</p>

	<tag>--with-localhost-ipv6</tag>
	<p>Build support for squid to map all 127.0.0.1 traffic onto ::1.
           The default is to build with 127.0.0.1 and ::1 being considered seperate IP.
           see the IPv6 details above for a better description. 
        </p>

        <tag>--with-ipv6-split-stack</tag>
        <p>Enable special additions for IPv6 support in Windows XP.
           see the IPv6 details above for a better description.</p>

	<tag>--with-ipv4-mapped</tag>
	<p>Enable special additions for IPv6 support in Windows Vista.
           see the IPv6 details above for a better description.</p>

        <tag>--with-dns-cname</tag>
        <p>Enable CNAME recursion within the Internal DNS resolver stub squid uses.
           This has no effect on the external DNS helper.
           Please note this extension is still experimental and may encounter problems.
	   To see if it is actually needed you can run squid without it for a period and
	   check the CNAME-Only Requests statistics squid maintains.
	   If it produces ongoing serious problems the external helper may be needed
	   but please report the bugs anyway.
        </p>

	<tag>--enable-auto-locale</tag>
	<p>Enable error page localization for visitors.</p>

</descrip>
</p>

<sect2>Changes to existing options<label id="modifiedoptions">

<p>
<descrip>
	<tag>--disable-internl-dns</tag>
	<p>Better support for Linux using the external DNS helper.
           The helper will compile and work with dns_nameservers on more variants of Linux than previously.</p>

	<tag>--enable-linux-netfilter</tag>
	<p>This option now enables support for all three netfilter interception targets.
        Adding TPROXY version 4+ support to squid through the TPROXY target.
	This options requires a linux kernel 2.6.25 or later for embeded netfilter TPROXY targets.
	Older REDIRECT and DNAT targets work as before on HTTP ports marked 'intercept'.
	</p>

</descrip>
</p>

<sect2>Not yet available options<label id="notportedoptions">

<p>These configure options have not yet been ported to Squid-3. If you need something to do then
porting one of these from Squid-2 to Squid-3 is most welcome.

<descrip>
	<tag>--enable-devpoll</tag>
	<p>Support for Solaris /dev/poll</p>

	<tag>--enable-select-simple</tag>
	<p>Basic POSIX select() loop without any binary fd_set optimizations.</p>

	<tag>--enable-follow-x-forwarded-for</tag>
	<p>Support following the X-Forwarded-For HTTP header for determining the
	client IP address</p>
</descrip>

<sect2>Removed options<label id="removedoptions">

<p>The following configure options have been removed.

<descrip>
	<tag>--enable-linux-tproxy</tag>
	<p>Replaced by --enable-linux-tproxy2 to make way for differences in TPROXY v2 and v4 support.</p>
	<tag>--enable-default-err-language</tag>
	<p>Replaced by error_default_language squid.conf option</p>
	<tag>--enable-err-languages</tag>
	<p>Removed.</p>
</descrip>

</article>
